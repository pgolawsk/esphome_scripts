---
#* Set total Water Usage by native ESPHome API
# Pawelo, 20230916, created based on https://github.com/esphome/feature-requests/issues/461
# Pawelo, 20250913, add log message when setting total water usage
# Pawelo, 20250913, tested in real use

service: set_total_water${ix}
variables:
  water_meter_reading: float
then:
  - lambda: |-
      ESP_LOGI("set_total", "HA: Setting total for \"%s\" to %.1f Liters (with %d pulses, it will be: %d)", "${ix}", water_meter_reading, ${pulses_per_liter}, static_cast<int>(water_meter_reading * ${pulses_per_liter}));
      wifi::global_wifi_component->start_scanning();
  - pulse_meter.set_total_pulses:
      id: water_flow${ix}
      value: !lambda 'return static_cast<int>(water_meter_reading * ${pulses_per_liter});'