---
#* MQTT on message to play RTTTL
# Pawelo, 20230129, added RTTTL topic to play
# Pawelo, 20230130, moved rtttl_play_it to separate include file

# Example tones
# siren:d=8,o=5,b=100:d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e
# MissionImp:d=16,o=6,b=95:32d,32d#,32d,32d#,32d,32d#,32d,32d#,32d,32d,32d#,32e,32f,32f#,32g,g,8p,g,8p,a#,p,c7,p,g,8p,g,8p,f,p,f#,p,g,8p,g,8p,a#,p,c7,p,g,8p,g,8p,f,p,f#,p,a#,g,2d,32p,a#,g,2c#,32p,a#,g,2c,a#5,8c,2p,32p,a#5,g5,2f#,32p,a#5,g5,2f,32p,a#5,g5,2e,d#,8d

topic: ${topic_prefix}/rtttl_play_it
then:
  - if:
      condition:
        lambda: |-
          return x == "" || x == "ON";
      then:
        - logger.log: "Recieved MQTT RTTL activation - playing confirmation."
        - rtttl.play: "success:d=24,o=5,b=100:c,g,b"
      else:
        - logger.log: "Recieved MQTT RTTTL to play."
        - rtttl.play:
            rtttl: !lambda "return x;"
  - repeat:
      count: ${led_cycles}
      then:
        - light.turn_on: status_led
        - delay: 300ms
        - light.turn_off: status_led
        - delay: 300ms
